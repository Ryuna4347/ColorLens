# ColorLens
- 이 게임은 2020 BIC 게임잼에 제출한 작품으로, 유니티를 기반으로 제작한 2D형식의 퍼즐 게임입니다.

![ColorLens](https://s3.us-west-2.amazonaws.com/secure.notion-static.com/9e75f917-8ee3-47f3-a1d2-210a01c87e02/b2de04cb831c7e8a.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIAT73L2G45O3KS52Y5%2F20210327%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20210327T160324Z&X-Amz-Expires=86400&X-Amz-Signature=8cd9c39b7c1ec26451810a93f946edbc8f80ef72ed0bc03e461e25c107e1c3fe&X-Amz-SignedHeaders=host&response-content-disposition=filename%20%3D%22b2de04cb831c7e8a.png%22)

# 빌드 버전

2019.4.8

# 개발 기간

2020년 8월 ~ 10월 : BIC 게임잼 및 전시

2020년 8월 ~ 현재 : 출시 준비중

# 개발 인원

BIC 게임잼 : 6명

BIC 전시 : 5명

BIC 전시 이후 ~ 현재 : 3명(기획 및 디자인 : 이은수, 프로그래밍 : 유현우, 조욱래)

## 게임 설명
빛의 3원색 원리를 이용하는 게임이며, 색상 캐릭터를 유저가 움직여서 상자 색상에 맞는 캐릭터를 집어넣어 미궁을 탈출시키는 것이 목적입니다. 

## 게임 규칙
ASWD(또는 화살표)를 통해 캐릭터의 이동이 가능하며, 맵 내에 있는 색상 캐릭터들은 사용자의 키보드 입력에 맞추어 동시에 해당 방향으로 이동합니다. 
색상 캐릭터들은 흰색 타일 위에서만 이동이 가능하고, 검은색 벽에 닿을 경우 해당 캐릭터는 벽에 흡수되어 더 이상 이동할 수 없게 됩니다.

맵에 위치한 특정 오브젝트(거울/렌즈/프리즘)을 건드리면 캐릭터의 이동 방향이 바뀌거나 캐릭터가 다른 색상으로 분열되어 여러 색상의 캐릭터가 생성됩니다.
반대로 같은 위치에 두 개 이상의 다른 색상 캐릭터를 놓을 경우 색상이 합성되어 한 개의 캐릭터가 생성됩니다.

이들 색상 캐릭터는 맵 내의 색상 상자에 접촉하여 상자를 닫을 수 있습니다. 조건에 충족하지 못하는 경우, 상자에 흡수되어 캐릭터를 더 이상 이동시킬 수 없습니다. 색상 상자를 닫을 수 있는 조건은 아래와 같습니다.

1. 색상 상자가 색상 캐릭터보다 같거나 높은 단계의 합성색인 경우(빨강->빨강 OR 빨강->노랑(빨강+초록))
2. 색상 상자가 가진 색상이 색상 캐릭터의 색을 포함하는 경우(빨강->파랑은 포함하는 색이 없으므로 조건을 만족하지 못합니다.)

* * *

## 승리/패배 규칙

맵 내의 상자가 모두 조건을 만족했을 경우 성공이며, 더 이상 움직일 수 있는 캐릭터가 없게 되는 경우 스테이지 클리어 실패가 됩니다.(상자에 맞지 않는 색상 캐릭터여도 움직일 수 있으면 실패가 되지 않습니다.)

* * *

## 챕터 및 스테이지
현재 총 4개의 챕터로 이루어져 있으며, 각 챕터는 12스테이지로 나누어져 있습니다. 각 챕터마다의 컨셉은 아래와 같습니다.

1) 1챕터 : 기본적인 이동/거울
2) 2챕터 : 프리즘
3) 3챕터 : 볼록렌즈/오목렌즈
4) 4챕터 : 모든 오브젝트 응용
5) 5챕터 : 포탈
6) 6챕터 : 필터
7) 7챕터 : 열쇠 & 잠금상자

* * *

## 캐릭터

스테이지 내에 존재하는 모든 캐릭터는 GameManager가 2차원 배열로 위치 및 상태를 관리하며, 충돌 체크에 대한 요청과 이동만 캐릭터에서 담당합니다. 스테이지 내 모든 캐릭터는 사용자의 입력에 따라 
동시에 같은 방향으로 움직이며, 움직이기 전 CalculateRoute()를 사용하여 캐릭터가 움직일 좌표 리스트를 계산한 다음 Move() 코루틴을 통해 1칸씩 정해진 좌표로 이동을 시도합니다. CalculateRoute()는 분리 아이템(프리즘/필터)이나 색상 캐릭터끼리의 합성으로 인해 이동 중간 새로운 캐릭터가 생성될 경우를 제외하고 모든 이동 경로를 계산하게 됩니다.

새로운 캐릭터가 생성되는 경우에는 직전까지의 이동 좌표를 계산하고, 이후 새로운 캐릭터가 생성되었을 때 각 캐릭터의 CalculateRoute()를 다시 호출하여 생성 지점으로부터의 경로를 다시 계산한 뒤 이동합니다.

### 캐릭터 이동에 대한 변경사항

캐릭터의 이동 경로 계산 및 이동에 대한 함수는 BIC 게임잼, BIC 전시, 현재로 3번 변경되었습니다. 각 이동 방식에 대한 설명과 변경한 이유는 아래와 같습니다.

**1) BIC 게임잼**

2일이 채 안 되는 기간 동안 개발을 진행하려다 보니 논리적인 함수를 만들지 못하고 캐릭터가 한 칸 이동할 때마다 자신이 이동할 좌표(현재 x,y 좌표 주위 8방향 중 하나)를 향해 Raycast를 진행하여 충돌하는 아이템이 존재하는지 파악하고, 캐릭터를 이동시킨 후 아이템에 대한 충돌 처리를 진행하였습니다. 생각난 대로 코드를 작성하였기 때문에 비교적 빠른 시간 안에 간단하게 코드를 완성할 수 있는 것이 장점이었습니다.

단점 : 캐릭터가 한 칸씩 이동하는 것을 구현하기 위해 코루틴을 사용하여 정해진 방향으로 이동 후 정지를 반복하면서 함수를 진행하였는데, 프리즘이나 렌즈 등 다른 아이템과 충돌을 할 경우 이동 경로 회절을 위해 기존 코루틴을 잠시 중단하고, 새로운 이동 코루틴을 실행하고 끝난 뒤 다시 기존 코루틴으로 돌아와 진행하는 방식의 복잡한 구조가 되었습니다. 

이로 인해 연속으로 아이템에 충돌할 경우 코루틴이 3중첩 이상이 되면서 코루틴을 관리하기가 매우 버거워지는 단점이 있었습니다. 또한 캐릭터마다 이동을 담당하기 때문에 다른 캐릭터 또는 아이템과 도중에 충돌할 경우 예상치 못한 오류가 발생하는 오류가 생기기도 하였습니다.

**2) BIC 전시**

BIC 게임잼에서 사용했던 Raycast를 통한 이동의 단점을 보완하기 위해 캐릭터의 이동 방식은 유지한 채, Ray가 아닌 Physics2D.OverlapCircle()을 사용한 충돌체크로 변경하였습니다. 이동할 좌표에서 옆 타일에 충돌하지 않을 만큼의 거리 내의 콜라이더와의 충돌을 체크하기 때문에, 대각 이동 시 Ray 벡터에 약 1.4배를 해주거나 Ray의 판정 영역이 작아 타일 좌표가 살짝 엇나가면 그 이후부터 충돌이 제대로 체크되지 않는 단점을 가진 Raycast 방식보다는 안정적으로 타일/아이템과의 충돌을 체크하면서 캐릭터를 진행시킬 수 있었습니다.

단점 : 색상 캐릭터 별로 따로 이동을 관리하기 때문에 언제 다른 캐릭터, 아이템과 부딪힐 지 예측할 수가 없었기 때문에 모든 캐릭터는 한 칸 이동할 때마다 다른 오브젝트와의 충돌 여부를 체크해야했습니다. 

또한 한 색상 캐릭터의 이동이 중지된 상태에서 해당 좌표로 다른 색상 캐릭터가 그 좌표를 지나간 경우와 같은 애매한 상황이 발생하여 예상치 못한 에러가 발생하는 문제가 있었습니다. 

마지막으로 캐릭터가 이동 도중 이동 루트가 아이템에 의해 여러번 변경되거나 다른 좌표로 이동해야하는 경우 진행중인 코루틴에서 동일한 코루틴이 연속적으로 호출되어 관리하기가 매우 까다로웠습니다.

**3) 현재**

'캐릭터' 항목에 기술하였듯 현재 모든 캐릭터는 GameManager가 스테이지 시작부터 끝까지 2차원 배열을 사용하여 캐릭터의 위치를 관리합니다. 캐릭터마다 이동 루트를 계산하여 매니저에 전달하면, 매니저에서 캐릭터의 위치를 갱신하고 관리하기 때문에 이동 도중 충돌에 대한 처리(본 게임에서는 캐릭터 간 합성은 모든 캐릭터가 정지시에만 가능합니다.)가 사전에 가능해졌으며, 캐릭터가 다른 좌표로 이동하는 포탈 같은 아이템에도 간단히 대응할 수 있게 되었습니다. 

* * *

## 아이템

각 스테이지에 들어가는 모든 아이템은 하나의 그룹으로 관리하기 위하여 IObjectBase 인터페이스를 상속받아서 사용합니다. 모든 아이템은 타일맵을 통해 관리가 이루어지는데, 2칸을 차지하는 아이템(볼록렌즈/오목렌즈)의 경우 가운데 중점을 배열 인덱스에 맞추어 변형한 후, 현재 모양이 가로인지 세로인지에 따라 X 혹은 Y의 값을 +-0.5 더해주어 타일맵에 2칸 모두 기록하여 관리합니다. 

* * *

## 스테이지 관리

각 스테이지는 별도의 씬에 저장되어 있으며, 씬에서 렌더링 순서(타일->캐릭터->아이템/색상 상자)를 지정하고 동일한 오브젝트끼리 분류를 하기 위해 Tile pallette를 사용하여 캐릭터/아이템/도착 지점(색상 상자)/타일(벽, 통로)의 다른 타일맵으로 관리합니다. 


# Contact
유현우 yhw7979@gmail.com
